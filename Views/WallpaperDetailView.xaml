<UserControl
    x:Class="WallpaperEngine.Views.WallpaperDetailView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:WallpaperEngine.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dg="clr-namespace:System.Diagnostics;assembly=WindowsBase"
    xmlns:local="clr-namespace:WallpaperEngine.Views"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="clr-namespace:WallpaperEngine.ViewModels"
    x:Name="wallpaperDetailView"
    d:DataContext="{d:DesignInstance Type=viewmodels:WallpaperDetailViewModel}"
    mc:Ignorable="d">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/Colors2.xaml" />
                <ResourceDictionary Source="/Styles/MaterialCardStyle.xaml" />
                <ResourceDictionary Source="/Styles/SectionHeader.xaml" />
                <ResourceDictionary Source="/Styles/FieldLabel.xaml" />
                <ResourceDictionary Source="/Styles/SmartTextFieldStyle.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <converters:ImagePathToSourceConverter x:Key="ImageToSourceConverter" />
            <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <!--  é¢„è§ˆå›¾  -->
            <RowDefinition Height="2*" MinHeight="80" />
            <!--  ä¿¡æ¯åŒº  -->
            <RowDefinition Height="3*" MinHeight="80" />
            <!--  æ“ä½œæŒ‰é’®  -->
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  é¢„è§ˆåŒºåŸŸ  -->
        <Border
            Grid.Row="0"
            Background="Black"
            CornerRadius="6">
            <Image
                VerticalAlignment="Center"
                Source="{Binding CurrentWallpaper.PreviewImagePath, Converter={StaticResource ImageToSourceConverter}}"
                Stretch="Uniform" />
        </Border>

        <!--  ä¿¡æ¯åŒºï¼šå•åˆ—  -->
        <ScrollViewer
            Grid.Row="1"
            Margin="0,8,0,0"
            VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!--  æ ‡é¢˜  -->
                <ContentControl
                    Margin="0,0,0,8"
                    Content="{Binding Title, Mode=TwoWay}"
                    Style="{StaticResource SmartTitleField}" />

                <!--  åŸºæœ¬ä¿¡æ¯  -->
                <Grid Margin="0,0,0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock
                        VerticalAlignment="Top"
                        FontWeight="Bold"
                        Text="æè¿°:" />
                    <ScrollViewer
                        Grid.Column="1"
                        Margin="6,0,0,0"
                        MaxHeight="80"
                        VerticalAlignment="Top"
                        VerticalScrollBarVisibility="Auto">
                        <ContentControl
                            Margin="0"
                            VerticalAlignment="Top"
                            Content="{Binding Description, Mode=TwoWay}"
                            Style="{StaticResource SmartTextField}" />
                    </ScrollViewer>
                </Grid>

                <!--  åˆ†ç±»ä¿¡æ¯  -->
                <StackPanel Margin="0,0,0,4" Orientation="Horizontal">
                    <TextBlock
                        VerticalAlignment="Center"
                        FontWeight="Bold"
                        Text="ç±»åž‹:" />
                    <ComboBox
                        Margin="6,0,0,0"
                        FontSize="14"
                        IsEnabled="{Binding IsEditMode}"
                        ItemsSource="{Binding WallpaperTypes}"
                        SelectedItem="{Binding SelectedType, Mode=TwoWay}"
                        Style="{StaticResource MaterialDesignDataGridComboBox}" />
                </StackPanel>
                <Grid Margin="0,0,0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBlock
                        VerticalAlignment="Center"
                        FontWeight="Bold"
                        Text="åˆ†ç±»:" />
                    <ComboBox
                        Grid.Column="1"
                        Margin="6,0,0,0"
                        VerticalAlignment="Center"
                        FontSize="14"
                        IsEnabled="{Binding IsEditMode}"
                        ItemsSource="{Binding CategoryList}"
                        SelectedItem="{Binding SelectedCategory, Mode=TwoWay}"
                        Style="{StaticResource MaterialDesignDataGridComboBox}" />
                    <Button
                        Grid.Column="2"
                        Width="24"
                        Height="24"
                        Margin="4,0,0,0"
                        Padding="0"
                        VerticalAlignment="Center"
                        Command="{Binding AddCategoryCommand}"
                        Content="+"
                        FontSize="14"
                        IsEnabled="{Binding IsEditMode}"
                        Style="{StaticResource MaterialDesignIconButton}"
                        ToolTip="æ–°å¢žåˆ†ç±»" />
                </Grid>

                <!--  æ ‡ç­¾  -->
                <StackPanel Margin="0,0,0,2" Orientation="Horizontal">
                    <TextBlock
                        VerticalAlignment="Center"
                        FontWeight="Bold"
                        Text="æ ‡ç­¾" />
                    <Button
                        Width="22"
                        Height="22"
                        Margin="6,0,0,0"
                        Padding="0"
                        VerticalAlignment="Center"
                        Command="{Binding AddTagCommand}"
                        Content="+"
                        FontSize="13"
                        IsEnabled="{Binding IsEditMode}"
                        Style="{StaticResource MaterialDesignIconButton}"
                        ToolTip="æ–°å¢žæ ‡ç­¾" />
                </StackPanel>
                <Border
                    Margin="0,0,0,6"
                    Padding="6"
                    Background="{StaticResource LightBackground}"
                    CornerRadius="4">
                    <ItemsControl ItemsSource="{Binding Tags}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border
                                    Margin="2,2"
                                    Padding="6,2"
                                    Background="{StaticResource SecondaryBrush}"
                                    CornerRadius="10">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock
                                            VerticalAlignment="Center"
                                            FontSize="11"
                                            FontWeight="SemiBold"
                                            Foreground="White"
                                            Text="{Binding}" />
                                        <Button
                                            Width="14"
                                            Height="14"
                                            Margin="3,0,0,0"
                                            Padding="0"
                                            VerticalAlignment="Center"
                                            Command="{Binding DataContext.RemoveTagCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Content="x"
                                            FontSize="9"
                                            Foreground="White"
                                            Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <Button.Style>
                                                <Style BasedOn="{StaticResource MaterialDesignIconButton}" TargetType="Button">
                                                    <Setter Property="Background" Value="Transparent" />
                                                    <Setter Property="BorderThickness" Value="0" />
                                                </Style>
                                            </Button.Style>
                                        </Button>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Border>

                <!--  æ–‡ä»¶ä¿¡æ¯  -->
                <StackPanel Margin="0,0,0,6" Orientation="Horizontal">
                    <TextBlock
                        VerticalAlignment="Center"
                        FontWeight="Bold"
                        Text="æ–‡ä»¶å:" />
                    <ContentControl
                        Margin="6,0,0,0"
                        VerticalAlignment="Center"
                        Content="{Binding ContentFileName}"
                        FontSize="12"
                        Style="{StaticResource SmartTextField}" />
                </StackPanel>
                <StackPanel Margin="0,0,0,6" Orientation="Horizontal">
                    <TextBlock
                        VerticalAlignment="Center"
                        FontWeight="Bold"
                        Text="é¢„è§ˆå›¾:" />
                    <TextBlock
                        Margin="6,0,0,0"
                        VerticalAlignment="Center"
                        FontSize="12"
                        Text="{Binding PreviewFileName, Mode=TwoWay}" />
                </StackPanel>
                <TextBlock
                    Margin="0,4,0,2"
                    FontWeight="Bold"
                    Text="ç›®å½•æ–‡ä»¶:" />
                <Border
                    Margin="0,4,0,0"
                    Padding="6"
                    Background="{StaticResource LightBackground}"
                    CornerRadius="4">
                    <ListBox
                        Background="Transparent"
                        BorderThickness="0"
                        ItemsSource="{Binding CurrentWallpaper.FileNameList}"
                        Style="{StaticResource MaterialDesignFilterChipOutlineListBox}">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Vertical" />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="90" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock
                                        VerticalAlignment="Center"
                                        FontSize="11"
                                        Text="{Binding}"
                                        TextTrimming="CharacterEllipsis"
                                        ToolTip="{Binding}" />
                                    <Button
                                        Grid.Column="1"
                                        Height="20"
                                        Margin="4,0,0,0"
                                        Padding="6,1"
                                        Command="{Binding DataContext.SetContentFileNameCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                        CommandParameter="{Binding}"
                                        Content="é€‰æ‹©ä¸ºå†…å®¹æ–‡ä»¶"
                                        FontSize="9"
                                        Style="{StaticResource MaterialDesignOutlinedButton}"
                                        Visibility="{Binding IsEnabled, RelativeSource={RelativeSource Self}, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                    <Button
                                        Grid.Column="2"
                                        Height="20"
                                        Margin="4,0,0,0"
                                        Padding="6,1"
                                        Command="{Binding DataContext.SetPreviewFileNameCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                        CommandParameter="{Binding}"
                                        Content="é€‰æ‹©ä¸ºé¢„è§ˆå›¾"
                                        FontSize="9"
                                        Style="{StaticResource MaterialDesignOutlinedButton}"
                                        Visibility="{Binding IsEnabled, RelativeSource={RelativeSource Self}, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!--  æ“ä½œæŒ‰é’®åŒºåŸŸ  -->
        <WrapPanel
            Grid.Row="2"
            Margin="0,8,0,0"
            VerticalAlignment="Center"
            Orientation="Horizontal">
            <!--  ç¼–è¾‘æ“ä½œ  -->
            <Button
                x:Name="EditButton"
                Height="28"
                Margin="4,2"
                Padding="10,0"
                Background="Transparent"
                BorderThickness="0"
                Command="{Binding StartEditCommand}"
                Content="âœï¸"
                FontSize="12"
                Style="{StaticResource MaterialDesignOutlinedButton}"
                ToolTip="ç¼–è¾‘"
                Visibility="{Binding IsEditMode, Converter={StaticResource InverseBooleanConverter}, ConverterParameter=Visibility}" />
            <Button
                x:Name="SaveButton"
                Height="28"
                Margin="4,2"
                Padding="10,0"
                Background="Transparent"
                BorderThickness="0"
                Command="{Binding SaveEditCommand}"
                Content="ðŸ’¾"
                FontSize="12"
                Style="{StaticResource MaterialDesignOutlinedButton}"
                ToolTip="ä¿å­˜"
                Visibility="{Binding IsEditMode, Converter={StaticResource BooleanToVisibilityConverter}}" />
            <Button
                x:Name="CancelButton"
                Height="28"
                Margin="4,2"
                Padding="10,0"
                Background="Transparent"
                BorderThickness="0"
                Command="{Binding CancelEditCommand}"
                Content="âŒ"
                FontSize="12"
                Style="{StaticResource MaterialDesignOutlinedButton}"
                ToolTip="å–æ¶ˆ"
                Visibility="{Binding IsEditMode, Converter={StaticResource BooleanToVisibilityConverter}}" />

            <Rectangle
                Width="1"
                Height="20"
                Margin="8,2"
                Fill="#E0E0E0" />

            <!--  åŠŸèƒ½æ“ä½œ  -->
            <Button
                Height="28"
                Margin="4,2"
                Padding="4,0"
                Background="Transparent"
                BorderThickness="0"
                Command="{Binding DataContext.ToggleFavoriteCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                CommandParameter="{Binding CurrentWallpaper}"
                FontSize="20"
                Style="{StaticResource MaterialDesignOutlinedButton}">
                <Button.Resources>
                    <Style TargetType="TextBlock">
                        <Setter Property="Text" Value="ðŸ¤" />
                        <Setter Property="ToolTip" Value="æ”¶è—" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding CurrentWallpaper.IsFavorite}" Value="True">
                                <Setter Property="Text" Value="ðŸ’”" />
                                <Setter Property="ToolTip" Value="å–æ¶ˆæ”¶è—" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Resources>
                <TextBlock />
            </Button>
            <Button
                x:Name="btnPreview"
                Height="28"
                Margin="4,2"
                Padding="4,0"
                Background="Transparent"
                BorderThickness="0"
                Command="{Binding DataContext.PreviewWallpaperCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                CommandParameter="{Binding CurrentWallpaper}"
                Content="ðŸ‘ï¸"
                FontSize="14"
                Style="{StaticResource MaterialDesignOutlinedButton}"
                ToolTip="é¢„è§ˆ" />
            <Button
                Height="28"
                Margin="4,2"
                Padding="4,0"
                Background="Transparent"
                BorderThickness="0"
                Command="{Binding DataContext.ApplyWallpaperCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                CommandParameter="{Binding CurrentWallpaper}"
                Content="ðŸ’«"
                FontSize="14"
                Style="{StaticResource MaterialDesignOutlinedButton}"
                ToolTip="åº”ç”¨" />
            <Button
                Height="28"
                Margin="4,2"
                Padding="4,0"
                Background="Transparent"
                BorderThickness="0"
                Command="{Binding DataContext.DeleteWallpaperCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                CommandParameter="{Binding CurrentWallpaper}"
                Content="ðŸ—‘ï¸"
                FontSize="14"
                Foreground="{StaticResource AccentBrush}"
                Style="{StaticResource MaterialDesignOutlinedButton}"
                ToolTip="åˆ é™¤" />
        </WrapPanel>
    </Grid>
</UserControl>
