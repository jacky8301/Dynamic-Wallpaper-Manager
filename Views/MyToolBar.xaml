<UserControl
    x:Class="WallpaperEngine.Views.MyToolBar"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:WallpaperEngine.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:fa="http://schemas.fontawesome.io/icons/"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">
    <UserControl.Resources>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter" />
    </UserControl.Resources>
    <ToolBar Background="#F0F0F0">
        <StackPanel Margin="5" Orientation="Horizontal">
            <!--  搜索框 - FontAwesome版本  -->
            <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                <TextBlock
                    Margin="0,0,5,0"
                    VerticalAlignment="Center"
                    Text="搜索:" />

                <Border
                    Width="260"
                    Height="32"
                    Background="White"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    CornerRadius="4">
                    <Grid Margin="2,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!--  搜索文本框  -->
                        <TextBox
                            x:Name="SearchTextBox"
                            Grid.Column="0"
                            Padding="8,0,0,0"
                            VerticalContentAlignment="Center"
                            Background="Transparent"
                            BorderThickness="0"
                            KeyDown="TextBox_KeyDown"
                            Text="{Binding SearchText, UpdateSourceTrigger=Explicit}">
                            <TextBox.Style>
                                <Style TargetType="TextBox">
                                    <Setter Property="Margin" Value="0" />
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="WhiteSmoke" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                        <!--  清除按钮 - 圆形背景，悬停效果  -->
                        <Button
                            Grid.Column="1"
                            Width="24"
                            Height="24"
                            Margin="0,0,4,0"
                            VerticalAlignment="Center"
                            Background="Transparent"
                            BorderThickness="0"
                            Click="ClearButton_Click"
                            Cursor="Hand"
                            ToolTip="清除"
                            Visibility="{Binding SearchText, Converter={StaticResource StringToVisibilityConverter}}">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border
                                                    Width="24"
                                                    Height="24"
                                                    Background="{TemplateBinding Background}"
                                                    CornerRadius="12">
                                                    <fa:ImageAwesome
                                                        Width="16"
                                                        Height="16"
                                                        Foreground="Gray"
                                                        Icon="TimesCircle" />
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#FFE0E0E0" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <!--  搜索按钮 - 悬停效果  -->
                        <Button
                            Grid.Column="2"
                            Width="28"
                            Height="28"
                            VerticalAlignment="Center"
                            Background="Transparent"
                            BorderThickness="0"
                            Click="SearchButton_Click"
                            Cursor="Hand"
                            ToolTip="搜索">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border
                                                    Width="28"
                                                    Height="28"
                                                    Background="{TemplateBinding Background}"
                                                    CornerRadius="4">
                                                    <fa:ImageAwesome
                                                        Width="16"
                                                        Height="16"
                                                        Foreground="#555555"
                                                        Icon="Search" />
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#FFE0E0E0" />
                                            <Setter Property="Cursor" Value="Hand" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>
                </Border>
            </StackPanel>
            <!--  分类筛选  -->
            <ComboBox
                Width="100"
                Margin="5,0"
                ItemsSource="{Binding Categories}"
                SelectedItem="{Binding SelectedCategory}" />
            <!--  收藏筛选  -->
            <CheckBox
                Content="仅显示收藏"
                IsChecked="{Binding ShowFavoritesOnly}"
                ToolTip="只显示已收藏的壁纸" />

            <Separator />
            <!--  扫描按钮组  -->
            <Button
                Margin="5,0"
                Command="{Binding FullScanWallpapersCommand}"
                Content="📁 扫描壁纸"
                ToolTip="扫描壁纸文件夹" />
            <Button
                Margin="5,0"
                Background="#4CAF50"
                Command="{Binding IncrementalScanWallpapersCommand}"
                Content="⚡ 快速增量扫描"
                Foreground="White"
                ToolTip="对上次扫描的文件夹进行增量扫描" />
            <Button
                Margin="5,0"
                Background="#F44336"
                Command="{Binding CancelScanCommand}"
                Content="❌ 取消"
                Foreground="White"
                ToolTip="取消当前扫描"
                Visibility="{Binding IsScanning, Converter={StaticResource BooleanToVisibilityConverter}}" />
            <Separator Margin="10,0" />
            <!--  扫描状态显示  -->
            <StackPanel
                Width="300"
                Margin="10,0"
                Orientation="Vertical">
                <TextBlock
                    FontWeight="Bold"
                    Text="{Binding ScanStatus}"
                    TextWrapping="Wrap" />
                <ProgressBar
                    Height="10"
                    Margin="0,5"
                    Visibility="{Binding IsScanning, Converter={StaticResource BooleanToVisibilityConverter}}"
                    Value="{Binding ScanProgress}" />
                <StackPanel Margin="0,5" Orientation="Horizontal">
                    <TextBlock
                        Margin="0,0,5,0"
                        Foreground="Green"
                        Text="新增:" />
                    <TextBlock Text="{Binding NewFoundCount}" />
                    <TextBlock
                        Margin="10,0,5,0"
                        Foreground="Blue"
                        Text="更新:" />
                    <TextBlock Text="{Binding UpdatedCount}" />
                    <TextBlock
                        Margin="10,0,5,0"
                        Foreground="Gray"
                        Text="跳过:" />
                    <TextBlock Text="{Binding SkippedCount}" />
                </StackPanel>
            </StackPanel>
            <!--  设置按钮  -->
            <Button
                Width="80"
                Height="35"
                Command="{Binding OpenSettingsCommand}"
                Content="⚙️ 设置"
                Style="{StaticResource MaterialDesignOutlinedButton}"
                ToolTip="设置">
                <Button.ContentTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Margin="5,0,0,0" Text="设置" />
                        </StackPanel>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>
        </StackPanel>
    </ToolBar>
</UserControl>