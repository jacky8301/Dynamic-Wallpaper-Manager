<UserControl
    x:Class="WallpaperEngine.Views.MyToolBar"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:fa="http://schemas.fontawesome.io/icons/"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:views="clr-namespace:WallpaperEngine.Views"
    mc:Ignorable="d">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/ModernComboBoxStyle.xaml" />
                <ResourceDictionary Source="/Converters/CommonConverters.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    <ToolBar Background="#F0F0F0">
        <StackPanel Margin="5" Orientation="Horizontal">
            <!--  搜索框  -->
            <views:SearchBox />
            <!--  分类筛选  -->
            <StackPanel
                Margin="10,0,5,0"
                VerticalAlignment="Center"
                Orientation="Horizontal">
                <TextBlock
                    Margin="0,0,5,0"
                    VerticalAlignment="Center"
                    Text="分类:" />
                <ComboBox
                    Width="130"
                    ItemContainerStyle="{StaticResource ModernComboBoxItem}"
                    ItemsSource="{Binding Categories}"
                    SelectedItem="{Binding SelectedCategory}"
                    Tag="{Binding}"
                    ToolTip="按分类筛选壁纸">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}"
                                       Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=UserControl}}">
                                <TextBlock.ContextMenu>
                                    <ContextMenu
                                        Visibility="{Binding Converter={StaticResource ProtectedCategoryToVisibilityConverter}}">
                                        <MenuItem
                                            Header="✏️ 重命名"
                                            Command="{Binding PlacementTarget.Tag.RenameCategoryCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                            CommandParameter="{Binding}" />
                                        <Separator />
                                        <MenuItem
                                            Header="🗑️ 删除分类"
                                            Foreground="Red"
                                            Command="{Binding PlacementTarget.Tag.DeleteCategoryCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                            CommandParameter="{Binding}" />
                                    </ContextMenu>
                                </TextBlock.ContextMenu>
                            </TextBlock>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
            </StackPanel>

            <Separator />
            <!--  扫描按钮组  -->
            <Button
                Margin="5,0"
                Command="{Binding FullScanWallpapersCommand}"
                Content="📁 扫描壁纸"
                ToolTip="扫描壁纸文件夹" />
            <Button
                Margin="5,0"
                Background="#4CAF50"
                Command="{Binding IncrementalScanWallpapersCommand}"
                Content="⚡ 快速增量扫描"
                Foreground="White"
                ToolTip="对上次扫描的文件夹进行增量扫描" />
            <Button
                Margin="5,0"
                Background="#F44336"
                Command="{Binding CancelScanCommand}"
                Content="❌ 取消"
                Foreground="White"
                ToolTip="取消当前扫描"
                Visibility="{Binding IsScanning, Converter={StaticResource BooleanToVisibilityConverter}}" />
            <Separator Margin="10,0" />
            <!--  扫描状态显示  -->
            <StackPanel
                Width="300"
                Margin="10,0"
                Orientation="Vertical">
                <TextBlock
                    FontWeight="Bold"
                    Text="{Binding ScanStatus}"
                    TextWrapping="Wrap" />
                <ProgressBar
                    Height="10"
                    Margin="0,5"
                    Visibility="{Binding IsScanning, Converter={StaticResource BooleanToVisibilityConverter}}"
                    Value="{Binding ScanProgress}" />
                <StackPanel Margin="0,5" Orientation="Horizontal">
                    <TextBlock
                        Margin="0,0,5,0"
                        Foreground="Green"
                        Text="新增:" />
                    <TextBlock Text="{Binding NewFoundCount}" />
                    <TextBlock
                        Margin="10,0,5,0"
                        Foreground="Blue"
                        Text="更新:" />
                    <TextBlock Text="{Binding UpdatedCount}" />
                    <TextBlock
                        Margin="10,0,5,0"
                        Foreground="Gray"
                        Text="跳过:" />
                    <TextBlock Text="{Binding SkippedCount}" />
                </StackPanel>
            </StackPanel>
            <!--  设置按钮  -->
            <Button
                Width="80"
                Height="35"
                Command="{Binding OpenSettingsCommand}"
                Content="⚙️ 设置"
                Style="{StaticResource MaterialDesignOutlinedButton}"
                ToolTip="设置">
                <Button.ContentTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Margin="5,0,0,0" Text="设置" />
                        </StackPanel>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>

            <Separator Margin="10,0" />

            <!--  壁纸总数  -->
            <StackPanel
                VerticalAlignment="Center"
                Orientation="Horizontal">
                <materialDesign:PackIcon
                    Width="16"
                    Height="16"
                    Margin="0,0,4,0"
                    VerticalAlignment="Center"
                    Foreground="#666"
                    Kind="ImageMultiple" />
                <TextBlock
                    VerticalAlignment="Center"
                    Foreground="#666"
                    Text="壁纸总数: " />
                <TextBlock
                    VerticalAlignment="Center"
                    FontWeight="SemiBold"
                    Foreground="#007ACC"
                    Text="{Binding TotalWallpaperCount}" />
            </StackPanel>
        </StackPanel>
    </ToolBar>
</UserControl>