<UserControl
    x:Class="WallpaperEngine.Views.CollectionView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:converters="clr-namespace:WallpaperEngine.Converters">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Converters/CommonConverters.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="220" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- å·¦ä¾§ï¼šåˆé›†åˆ—è¡¨ -->
        <Border Grid.Column="0" BorderBrush="#E0E0E0" BorderThickness="0,0,1,0" Background="#FAFAFA">
            <DockPanel Cursor="Hand">
                <!-- é¡¶éƒ¨æŒ‰é’® -->
                <StackPanel DockPanel.Dock="Top" Margin="8">
                    <Button
                        Command="{Binding CreateCollectionCommand}"
                        Content="ï¼‹ æ–°å»ºåˆé›†"
                        HorizontalAlignment="Stretch"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        materialDesign:ButtonAssist.CornerRadius="4"
                        Margin="0,0,0,8" />
                </StackPanel>

                <!-- åˆé›†åˆ—è¡¨ -->
                <ListBox
                    ItemsSource="{Binding Collections}"
                    SelectedItem="{Binding SelectedCollection}"
                    BorderThickness="0"
                    Background="Transparent"
                    ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                            <Setter Property="Padding" Value="0" />
                            <Setter Property="Margin" Value="0" />
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="12,10" Background="Transparent">
                                <Border.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem
                                            Header="âœï¸ é‡å‘½å"
                                            Command="{Binding DataContext.RenameCollectionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                                        <Separator />
                                        <MenuItem
                                            Header="ðŸ—‘ï¸ åˆ é™¤åˆé›†"
                                            Foreground="Red"
                                            Command="{Binding DataContext.DeleteCollectionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                                    </ContextMenu>
                                </Border.ContextMenu>
                                <TextBlock
                                    Text="{Binding Name}"
                                    FontSize="14"
                                    TextTrimming="CharacterEllipsis" />
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </DockPanel>
        </Border>

        <!-- å³ä¾§ï¼šå£çº¸ç½‘æ ¼ -->
        <Grid Grid.Column="1">
            <!-- æ— é€‰ä¸­åˆé›†æ—¶çš„æç¤º -->
            <StackPanel
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
                <StackPanel.Style>
                    <Style TargetType="StackPanel">
                        <Setter Property="Visibility" Value="Collapsed" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding SelectedCollection}" Value="{x:Null}">
                                <Setter Property="Visibility" Value="Visible" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </StackPanel.Style>
                <TextBlock
                    HorizontalAlignment="Center"
                    FontSize="16"
                    Foreground="#999"
                    Text="è¯·é€‰æ‹©æˆ–åˆ›å»ºä¸€ä¸ªåˆé›†"
                    Margin="0,0,0,16" />
                <Button
                    Command="{Binding CreateCollectionCommand}"
                    Content="ï¼‹ æ–°å»ºåˆé›†"
                    HorizontalAlignment="Center"
                    Padding="24,8"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    materialDesign:ButtonAssist.CornerRadius="4" />
            </StackPanel>

            <!-- å£çº¸åˆ—è¡¨ -->
            <ListBox
                ItemsSource="{Binding CollectionWallpapers}"
                BorderThickness="0"
                Background="Transparent"
                ScrollViewer.CanContentScroll="True"
                ScrollViewer.VerticalScrollBarVisibility="Auto"
                VirtualizingPanel.IsVirtualizing="True"
                VirtualizingPanel.VirtualizationMode="Recycling"
                VirtualizingPanel.ScrollUnit="Pixel"
                HorizontalContentAlignment="Stretch">
                <ListBox.Style>
                    <Style TargetType="ListBox">
                        <Setter Property="Visibility" Value="Visible" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding SelectedCollection}" Value="{x:Null}">
                                <Setter Property="Visibility" Value="Collapsed" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ListBox.Style>
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Padding" Value="0" />
                        <Setter Property="Margin" Value="0" />
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    </Style>
                </ListBox.ItemContainerStyle>
                <ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ListBox.ItemsPanel>
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border
                            Width="200"
                            Height="150"
                            Margin="5"
                            BorderBrush="#E0E0E0"
                            BorderThickness="1"
                            CornerRadius="4"
                            ClipToBounds="True">
                            <Grid>
                                <Image
                                    Source="{Binding PreviewImagePath, Converter={StaticResource ImageToSourceConverter}, IsAsync=True}"
                                    Stretch="UniformToFill" />
                                <!-- æ ‡é¢˜ -->
                                <Border VerticalAlignment="Bottom" Background="#80000000">
                                    <TextBlock
                                        Margin="5"
                                        FontSize="12"
                                        FontWeight="Bold"
                                        Foreground="White"
                                        Text="{Binding Project.Title}"
                                        TextWrapping="Wrap" />
                                </Border>
                                <!-- ç§»é™¤æŒ‰é’® -->
                                <Button
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Top"
                                    Margin="4"
                                    Width="24" Height="24"
                                    Padding="0"
                                    ToolTip="ä»Žåˆé›†ç§»é™¤"
                                    Command="{Binding DataContext.RemoveFromCollectionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                    CommandParameter="{Binding}"
                                    Style="{StaticResource MaterialDesignIconForegroundButton}">
                                    <materialDesign:PackIcon Kind="Close" Width="16" Height="16" Foreground="White" />
                                </Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>
    </Grid>
</UserControl>
