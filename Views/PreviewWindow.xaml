<Window
    x:Class="WallpaperEngine.Views.PreviewWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    Title="壁纸预览"
    Width="800"
    Height="600"
    AllowsTransparency="True"
    ResizeMode="CanResize"
    WindowStartupLocation="CenterOwner"
    WindowStyle="None">
    <WindowChrome.WindowChrome>
        <WindowChrome
            CaptionHeight="40"
            GlassFrameThickness="0"
            ResizeBorderThickness="6" />
    </WindowChrome.WindowChrome>
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/ControlButtonStyle.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <!--  标题栏  -->
        <Border
            Grid.Row="0"
            Height="40"
            Background="{DynamicResource MaterialDesign.Brush.Primary.Light}">
            <Grid>
                <StackPanel
                    Margin="10,0"
                    VerticalAlignment="Center"
                    Orientation="Horizontal">
                    <Image
                        Width="24"
                        Height="24"
                        Margin="0,0,8,0"
                        VerticalAlignment="Center"
                        Source="/Assets/app.ico" />
                    <TextBlock
                        VerticalAlignment="Center"
                        FontSize="14"
                        FontWeight="SemiBold"
                        Foreground="White"
                        Text="壁纸预览" />
                </StackPanel>

                <StackPanel
                    HorizontalAlignment="Right"
                    Orientation="Horizontal"
                    WindowChrome.IsHitTestVisibleInChrome="True">
                    <Button
                        x:Name="MinimizeButton"
                        Width="40"
                        Height="40"
                        Click="MinimizeButton_Click"
                        Style="{StaticResource MaterialDesignToolButton}"
                        ToolTip="最小化">
                        <materialDesign:PackIcon
                            Width="16"
                            Height="16"
                            Foreground="White"
                            Kind="WindowMinimize" />
                    </Button>
                    <Button
                        x:Name="MaximizeButton"
                        Width="40"
                        Height="40"
                        Click="MaximizeButton_Click"
                        Style="{StaticResource MaterialDesignToolButton}"
                        ToolTip="最大化">
                        <materialDesign:PackIcon
                            Width="16"
                            Height="16"
                            Foreground="White"
                            Kind="WindowMaximize" />
                    </Button>
                    <Button
                        x:Name="CloseButton"
                        Width="40"
                        Height="40"
                        Click="CloseButton_Click"
                        Style="{StaticResource MaterialDesignToolButton}"
                        ToolTip="关闭">
                        <materialDesign:PackIcon
                            Width="16"
                            Height="16"
                            Foreground="White"
                            Kind="WindowClose" />
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!--  标题栏  -->
            <Border
                Grid.Row="0"
                Height="40"
                Background="#2D2D30">
                <TextBlock
                    Margin="10,0"
                    VerticalAlignment="Center"
                    FontSize="16"
                    Foreground="White"
                    Text="{Binding WallpaperTitle}" />
            </Border>

            <!--  预览区域  -->
            <Border
                Name="PreviewContainer"
                Grid.Row="1"
                Background="Black">
                <Grid>
                    <!--  图片预览  -->
                    <Grid x:Name="ImagePreviewGrid" Visibility="Collapsed">
                        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                            <Image
                                x:Name="PreviewImg"
                                Source="{Binding PreviewImage}"
                                Stretch="None" />
                        </ScrollViewer>
                    </Grid>

                    <!--  视频预览  -->
                    <Grid x:Name="VideoPreviewGrid" Visibility="Collapsed">
                        <MediaElement
                            x:Name="PreviewVideo"
                            LoadedBehavior="Manual"
                            Stretch="Uniform" />

                        <!--  视频控制面板  -->
                        <Border
                            VerticalAlignment="Bottom"
                            Background="#CC000000">
                            <StackPanel>
                                <!--  进度条  -->
                                <Grid Margin="10,6,10,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock
                                        x:Name="CurrentTimeText"
                                        Grid.Column="0"
                                        VerticalAlignment="Center"
                                        FontSize="12"
                                        Foreground="#CCCCCC"
                                        Text="00:00" />
                                    <Slider
                                        x:Name="ProgressSlider"
                                        Grid.Column="1"
                                        Margin="8,0"
                                        VerticalAlignment="Center"
                                        IsMoveToPointEnabled="True"
                                        Maximum="1"
                                        Minimum="0"
                                        Thumb.DragStarted="ProgressSlider_DragStarted"
                                        Thumb.DragCompleted="ProgressSlider_DragCompleted"
                                        ValueChanged="ProgressSlider_ValueChanged"
                                        Value="0" />
                                    <TextBlock
                                        x:Name="TotalTimeText"
                                        Grid.Column="2"
                                        VerticalAlignment="Center"
                                        FontSize="12"
                                        Foreground="#CCCCCC"
                                        Text="00:00" />
                                </Grid>
                                <!--  控制按钮  -->
                                <StackPanel
                                    Margin="0,2,0,6"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Orientation="Horizontal">
                                    <Button
                                        x:Name="PlayPauseButton"
                                        Click="PlayPause_Click"
                                        Content="▶"
                                        Style="{StaticResource ControlButtonStyle}" />
                                    <Button
                                        Click="Stop_Click"
                                        Content="⏹"
                                        Style="{StaticResource ControlButtonStyle}" />
                                    <Slider
                                        x:Name="VolumeSlider"
                                        Width="80"
                                        VerticalAlignment="Center"
                                        Maximum="1"
                                        Minimum="0"
                                        ValueChanged="VolumeSlider_ValueChanged"
                                        Value="0.5" />
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!--  不支持的类型提示  -->
                    <TextBlock
                        x:Name="UnsupportedText"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontSize="20"
                        Foreground="White"
                        Text="不支持预览此类型的壁纸"
                        Visibility="Collapsed" />
                </Grid>
            </Border>

            <!--  底部按钮  -->
            <Border
                Grid.Row="2"
                Height="60"
                Background="#2D2D30">
                <StackPanel
                    Margin="10"
                    HorizontalAlignment="Right"
                    Orientation="Horizontal">
                    <Button
                        Width="100"
                        Height="30"
                        Background="#007ACC"
                        Click="ApplyButton_Click"
                        Content="应用壁纸"
                        Foreground="White" />
                    <Button
                        Width="80"
                        Height="30"
                        Margin="10,0,0,0"
                        Background="#333337"
                        Click="CloseButton_Click"
                        Content="关闭"
                        Foreground="White" />
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>